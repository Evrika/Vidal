{% extends 'VidalMainBundle::layout.html.twig' %}


{% block title %}
	<h1>{{ title }}</h1>
{% endblock %}


{% block middle %}
	<div class="outer">
		{% for msg in app.session.flashbag.get('test') %}
			<div class="msg">{{ msg }}</div>
		{% endfor %}

		{% include 'VidalMainBundle:Digest:render.html.twig' with {'digest':digest} %}

		<table cellpadding="0" cellspacing="0" border="0" style="width: 600px; margin:0 auto 20px;">
			<tr>
				<td style="font-family:{{ digest.font }}, sans-serif; font-size:12px; color:gray;">
					Вы получили это письмо, потому что подписаны на рассылку новостей портала
					<a href="http://www.vidal.ru">Vidal.ru</a><br/>
					<span
						style="color:gray">Если Вы не хотите больше получать нашу рассылку, Вы можете отписаться по</span>
					<a href="http://www.vidal.ru/unsubscribe-digest/{{ app.user.id }}/{{ app.user.created|date('Y-m-d_H:i:s') }}"
						>этой ссылке</a>.
				<td>
			</tr>
		</table>
	</div>

	{# форма #}
	<form id="delivery_form" method="POST" action="{{ path('delivery') }}">
		{{ form_widget(form.text) }}
		{{ form_widget(form) }}
	</form>

	{% if digest.progress %}
		<div class="progress">Рассылка запущена</div>
	{% else %}

	{% endif %}

	{# Подписанные и отписавшиеся #}
	<div class="subs">
		<table>
			<tr>
				<td class="first">Всего пользователей</td>
				<td>{{ total }}</td>
			</tr>
			<tr>
				<td class="first">Подписано</td>
				<td>{{ subscribed }}
					<span>(рассылаем тем, кто подтвердил электронный адрес, кто НЕ отписался от рассылки,
						и чей адрес действительно существует)</span>
				</td>
			</tr>
			<tr>
				<td class="first">Отписались за день</td>
				<td>{{ unsubscribed.day }}</td>
			</tr>
			<tr>
				<td class="first">Отписались за неделю</td>
				<td>{{ unsubscribed.week }}</td>
			</tr>
			<tr>
				<td class="first">Отписались за месяц</td>
				<td>{{ unsubscribed.month }}</td>
			</tr>
			<tr>
				<td class="first">Отписались за год</td>
				<td>{{ unsubscribed.year }}</td>
			</tr>
		</table>
	</div>
{% endblock %}


{% block stylesheets %}
	{{ parent() }}
	<style type="text/css">
		.outer {
			margin: 40px 0;
		}
		.progress {
			background: lightgreen;
			padding:    6px 10px;
			margin:     20px 0 10px;
		}
		.msg {
			background:    lightgreen;
			padding:       6px 10px;
			margin-bottom: 15px;
		}
		#delivery_form select, #delivery_form input[type="text"], #status_form input[type="text"] {
			width: 600px;
		}
		#delivery_form td.label, #status_form td.label {
			width: 200px;
		}
		#delivery_form td.widget, #status_form td.widget {
			width: auto;
		}
		#form_subject {
			margin-top: 10px;
		}
		.outer a {
			color: #00F;
		}
		.subs {
			border-top:  1px solid #ddd;
			margin-top:  25px;
			padding-top: 15px;
		}
		.subs > table {
			width:           100%;
			border-collapse: collapse;
		}
		.subs .first {
			color:       slategrey;
			font-weight: bold;
			width:       185px;
		}
		.subs span {
			color:     gray;
			font-size: 12px;
		}
		.form_table input[type=checkbox] {
			margin-left: 0;
			width:       18px;
			height:      18px;
		}
		.btn-red {
			width:         325px;
			border-radius: 4px;
		}
	</style>
{% endblock %}


{% block javascripts %}
	{{ parent() }}
	<script src="{{ asset('bundles/vidalmain/ckeditor/ckeditor.js') }}" type="text/javascript"></script>
	<script src="{{ asset('bundles/vidalmain/ckeditor/adapters/jquery.js') }}" type="text/javascript"></script>
	<script src="{{ asset('bundles/vidalmain/javascripts/ckeditor-config.js') }}"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			$('#delivery_form select').chosen({
				search_contains:           true,
				no_results_text:           "не найдено",
				placeholder_text_single:   "Выберите",
				placeholder_text_multiple: "Выберите"
			});
		});
	</script>
{% endblock %}