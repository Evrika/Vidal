{% extends 'VidalMainBundle::layout.html.twig' %}


{% block title %}
	<h1>
		{{ article.title|raw }}
		{# админам карандашик редактирования #}
		{% if is_granted('ROLE_ADMIN') %}
			<a class="admin-edit fade" target="_blank"
			   href="{{ path('admin_vidal_drug_article_edit', {'id':article.id}) }}">
				<img src="{{ asset('bundles/vidalmain/images/edit.png') }}"/>
			</a>
		{% endif %}
	</h1>
{% endblock %}


{% block nav %}
	<div class="breadcrumbs">
		<a href="{{ path('index') }}">Видаль</a>
		<i></i>
		<a href="{{ path('articles') }}">Медицинская энциклопедия</a>
		<i></i>
		<a href="{{ path('rubrique', {'rubrique':rubrique.rubrique}) }}">{{ rubrique }}</a>
	</div>
{% endblock %}


{% block content %}
	{% include 'VidalMainBundle:Article:render_article.html.twig' %}

	{# купить в интернет-аптеке #}
	{% if article.links.count %}
		<div class="anons links-title">
			Купить в интернет-аптеке
		</div>
		<ul class="ul-style links">
			{% for link in article.links if link.title is not empty %}
				<li>
					<a href="{{ link.url|raw }}">{{ link.title }}</a>
				</li>
			{% endfor %}
		</ul>
	{% endif %}

	{% if products is defined and products is not empty %}
		<div class="documents-anons anons">
			<b>{{ article.title|raw }}</b>: применяемые препараты безрецептурного отпуска
		</div>
		<div class="products non">
			{% include 'VidalDrugBundle:Vidal:render_products.html.twig' %}
			{% if products|length > 20 %}
				<div class="center">
					<a href="#" class="btn-red">Показать все {{ products|length }}</a>
				</div>
			{% endif %}
		</div>
	{% endif %}

	{% if pre_products is defined and pre_products is not empty %}
		<div class="documents-anons anons">
			<b>{{ article.title|raw }}</b>: применяемые рецептурные препараты
		</div>
		<div class="products pre">
			{% include 'VidalDrugBundle:Vidal:render_products.html.twig' with {'products':pre_products, 'companies':pre_companies, 'pictures':pre_pictures, 'infoPages':pre_infoPages} %}
			{% if pre_products|length > 20 %}
				<div class="center">
					<a href="#" class="btn-red">Показать все {{ pre_products|length }}</a>
				</div>
			{% endif %}
		</div>
	{% endif %}

	{% if molecules is defined and molecules is not empty %}
		<div class="documents-anons anons">
			<b>{{ article.title|raw }}</b>: возможно также применение препаратов с активными веществами
		</div>
		<ul class="ul-style documents">
			{% for molecule in molecules %}
				<li>
					<a href="{{ path('molecule', {'MoleculeID':molecule.MoleculeID}) }}"
					   class="no-underline">
						{{ molecule.RusName|upper|raw }}
					</a>
				</li>
			{% endfor %}
		</ul>
	{% endif %}

	<div class="anons red-warning">
		Перед началом применения любого препарата посоветуйтесь со специалистом
		и ознакомьтесь с инструкцией по применению.
	</div>

	{% include 'VidalMainBundle::yad_horizontal.html.twig' %}
{% endblock %}


{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" type="text/css" href="{{ asset('bundles/vidalmain/stylesheets/publication.css') }}"/>
	<style type="text/css">
		.documents-anons {
			margin-top: 22px;
		}
		.red-warning {
			color:      rgb(255, 49, 56);
			font-size:  12px;
			margin-top: 20px;
		}
		.ul-style + .documents {
			font-size: 16px;
		}
		.links-title {
			font-weight:   bold;
			margin-bottom: 5px;
		}
	</style>
{% endblock %}


{% block javascripts %}
	{{ parent() }}
	<script type="text/javascript">
		$(document).ready(function() {
			var maxRows = 20;

			var $products = $('.products.non');
			var rows = $products.find('tr').length;

			if (rows > maxRows) {
				$products.find('tr:gt(' + maxRows + ')').hide();
			}

			$products = $('.products.pre');
			rows = $products.find('tr').length;

			if (rows > maxRows) {
				$products.find('tr:gt(' + maxRows + ')').hide();
			}

			$('.btn-red').click(function(e) {
				e.preventDefault();
				var $btn = $(e.target);
				$btn.hide();
				$btn.closest('.products').find('tr').show();
				return false;
			});
		});
	</script>
{% endblock %}