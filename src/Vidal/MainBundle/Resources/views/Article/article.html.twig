{% extends 'VidalMainBundle::layout.html.twig' %}


{% block nav %}
	<div class="breadcrumbs">
		<a href="{{ path('index') }}">Видаль</a>
		<i></i>
		<a href="{{ path('articles') }}">Медицинская энциклопедия</a>
		<i></i>
		<a href="{{ path('rubrique', {'rubrique':rubrique.rubrique}) }}">{{ rubrique }}</a>
	</div>
{% endblock %}


{% block content %}
	{% set video = article.video and article.video.path is defined ? article.video.path : null %}

	<div itemscope="" itemtype="http://schema.org/NewsArticle">
		<h1 itemprop="headline">
			{{ article.title|raw }}
			{# админам карандашик редактирования #}
			{% if is_granted('ROLE_ADMIN') %}
				<a class="admin-edit fade" target="_blank"
				   href="{{ path('admin_vidal_drug_article_edit', {'id':article.id}) }}">
					<img src="{{ asset('bundles/vidalmain/images/edit.png') }}"/>
				</a>
			{% endif %}
		</h1>

		<div class="article-wrap text">
			{% if article.video and article.video.path is defined %}
				{% set width = article.videoWidth > 480 ? 480 : article.videoWidth %}
				{% set height = article.videoWidth > 480
				? (article.videoHeight * 480 / article.videoWidth) | number_format(0)
				: article.videoHeight %}

				<p id="player1"></p>

				<script src="{{ asset('bundles/vidalmain/javascripts/swfobject.js') }}" type="text/javascript"></script>
				<script type="text/javascript">
					var so = new SWFObject('/players/uppod.swf', 'mpl', {{ width }}, {{ height }}, '8');
					so.addParam('allowscriptaccess', 'always');
					so.addParam('allowfullscreen', 'true');
					so.addVariable('height', '{{ height }}');
					so.addVariable('width', '{{ width }}');
					so.addVariable('file', '{{ article.video.path }}');
					so.addVariable('bufferlength', '10');
					so.addVariable('autostart', 'false');
					so.addVariable('enablejs', 'true');
					so.write('player1');
				</script>
			{% endif %}

			{# видео вручную #}
			{% for video in article.videos if video.enabled %}
				{% include 'VidalMainBundle:Article:render_video.html.twig' with {'path':video.path, 'width':video.width, 'height':video.height, 'id':'video' ~ video.id} %}
			{% endfor %}

			<div class="article-body text" itemscope="" itemprop="articleBody">
				{{ article.body|raw }}

				{% if article.code is not empty %}
					{{ article.code|raw }}
				{% endif %}
			</div>

			<div class="article-footer">
				<span class="article-date">{{ article.date|date('d.m.Y') }}</span>
			</div>

			{{ render(controller('VidalMainBundle:Tag:tags', {'object':article})) }}
		</div>
	</div>

	{# купить в интернет-аптеке #}
	{% if article.links.count %}
		<div class="anons links-title">
			Купить в интернет-аптеке
		</div>
		<ul class="ul-style links">
			{% for link in article.links if link.title is not empty %}
				<li>
					<a href="{{ link.url|raw }}">{{ link.title }}</a>
				</li>
			{% endfor %}
		</ul>
	{% endif %}

	{% if products is defined and products is not empty %}
		<div class="announcement">
			<div class="anons-footer">
				<span>{{ article.title|raw }}</span>: применяемые препараты безрецептурного отпуска
				<i>{{ products|length }}</i>
			</div>
			<div class="products">
				{% include 'VidalDrugBundle:Vidal:render_products.html.twig' %}
			</div>
		</div>
	{% endif %}

	{% if pre_products is defined and pre_products is not empty %}
		<div class="announcement">
			<div class="anons-footer">
				<span>{{ article.title|raw }}</span>: применяемые рецептурные препараты
				<i>{{ pre_products|length }}</i>
			</div>
			<div class="products">
				{% include 'VidalDrugBundle:Vidal:render_products.html.twig' with {'products':pre_products, 'companies':pre_companies, 'pictures':pre_pictures, 'infoPages':pre_infoPages} %}
			</div>
		</div>
	{% endif %}

	<div class="anons red-warning">
		Перед началом применения любого препарата посоветуйтесь со специалистом
		и ознакомьтесь с инструкцией по применению.
	</div>

	{% include 'VidalMainBundle::yad_horizontal.html.twig' %}
{% endblock %}


{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" type="text/css" href="{{ asset('bundles/vidalmain/stylesheets/publication.css') }}"/>
	<style type="text/css">
		.documents-anons {
			margin-top: 22px;
		}
		.red-warning {
			color:      rgb(255, 49, 56);
			font-size:  12px;
			margin-top: 20px;
		}
		.ul-style + .documents {
			font-size: 16px;
		}
		.links-title {
			font-weight:   bold;
			margin-bottom: 5px;
		}
		.products {
			display: none;
		}
	</style>
{% endblock %}


{% block javascripts %}
	{{ parent() }}
	<script type="text/javascript" src="{{ asset('bundles/vidalmain/ckeditor/spoiler.js') }}"></script>

	<script type="text/javascript">
		$(document).ready(function() {
			$('.btn-red').click(function(e) {
				e.preventDefault();
				var $btn = $(e.target);
				$btn.hide();
				$btn.closest('.products').find('tr').show();
				return false;
			});
		});
	</script>
{% endblock %}