{% extends 'VidalMainBundle::layout.html.twig' %}

{% block content %}

    <div class="breadcrumbs">
        <a href="{{ path('index') }}">Видаль</a>
        <i></i>
        <span>Симптомы</span>
    </div>
    <table style="width: 600px">
        <tr>
            <td>
                Пол
                <select class="symptom-select" id="select-sex">
                    <option value="1">Мужской</option>
                    <option value="2">Женский</option>
                </select>
            </td>
            <td style="text-align: right">
                Часть тела
                <select class="symptom-select" id="select-party">
                    <optgroup label="Голова">
                        <option value="1"  intro="head" >Лоб</option>
                        <option value="15" intro="head" >Затылок</option>
                        <option value="2"  intro="head" >Глаза</option>
                        <option value="3"  intro="head" >Уши</option>
                        <option value="4"  intro="head" >Нос</option>
                        <option value="5"  intro="head" >Губы</option>
                    </optgroup>
                    <optgroup label="Туловище">
                        <option value="7"  intro="all">Шея</option>
                        <option value="8"  intro="all">Грудь</option>
                        <option value="16" intro="all-back">Спина</option>
                        <option value="17" intro="all-back">Поясница</option>
                        <option value="10" intro="all">Верхняя часть живота</option>
                        <option value="11" intro="all">Средняя часть живота</option>
                        <option value="31" intro="all">Нижняя часть живота</option>
                        <option value="18" intro="all-back">Ягодицы</option>
                        <option value="13" intro="all">Гениталии</option>
                    </optgroup>
                    <optgroup label="Конечности">
                        <option value="9">Руки</option>
                        <option value="6">ноги</option>
                    </optgroup>
                    <option value="14">Общие симптомы</option>
                </select>
            </td>
        </tr>
        <tr>
            <td id="body-render">
                {{ render(controller('VidalMainBundle:Symptom:body')) }}
            </td>
            <td style="vertical-align: top; text-align: right">
                <ul class="list-disease" id="select-symptom"></ul>
                <br />
                <div id="list-box">
                    <div>
                        <ul class="list-disease" id="select-disease"></ul>
                        <ul class="list-disease" id="select-state"></ul>
                    </div>
                    <a href="#" id="state-back">Назад</a>
                </div>
            </td>
        </tr>
        <tr>
            <td colspan="2" id="articles-box">

            </td>
        </tr>
    </table>
{% endblock %}




{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('bundles/vidalmain/jquery-chosen/chosen.jquery.min.js') }}"></script>
    <script>
        // Всякие глобальные переменные
        var sex = 1;
        var party = 'all';
        var subParty = 'all';
        var symptom  = 'all';
        var disease  = 0;
        var state  = 0;

        var party_men
        party_men= '<optgroup label="Голова">'+
                '<option value="1"  intro="head">Лоб</option>'+
                '<option value="15" intro="head">Затылок</option>'+
                '<option value="2"  intro="head">Глаза</option>'+
                '<option value="3"  intro="head">Уши</option>'+
                '<option value="4"  intro="head">Нос</option>'+
                '<option value="5"  intro="head">Губы</option>'+
                '</optgroup>'+
                '<optgroup label="Туловище">'+
                '<option value="7"  intro="all">Шея</option>'+
                '<option value="8"  intro="all">Грудь</option>'+
                '<option value="16" intro="all-back">Спина</option>'+
                '<option value="17" intro="all-back">Поясница</option>'+
                '<option value="10" intro="all">Верхняя часть живота</option>'+
                '<option value="11" intro="all">Средняя часть живота</option>'+
                '<option value="31" intro="all">Нижняя часть живота</option>'+
                '<option value="18" intro="all-back">Ягодицы</option>'+
                '<option value="13" intro="all">Гениталии</option>'+
                '</optgroup>'+
                '<optgroup label="Конечности">'+
                '<option value="9" intro="all">Руки</option>'+
                '<option value="6" intro="all">ноги</option>'+
                '</optgroup>'+
                '<option value="14" intro="all">Общие симптомы</option>';

        var party_women
        party_women= '<optgroup label="Голова">'+
                '<option value="20" intro="head" >Лоб</option>'+
                '<option value="34" intro="head" >Затылок</option>'+
                '<option value="21" intro="head" >Глаза</option>'+
                '<option value="22" intro="head" >Уши</option>'+
                '<option value="23" intro="head" >Нос</option>'+
                '<option value="24" intro="head" >Губы</option>'+
                '</optgroup>'+
                '<optgroup label="Туловище">'+
                '<option value="26" intro="all">Шея</option>'+
                '<option value="27" intro="all">Грудь</option>'+
                '<option value="35" intro="all-back">Спина</option>'+
                '<option value="36" intro="all-back">Поясница</option>'+
                '<option value="29" intro="all">Верхняя часть живота</option>'+
                '<option value="30" intro="all">Средняя часть живота</option>'+
                '<option value="31" intro="all">Нижняя часть живота</option>'+
                '<option value="37" intro="all-back">Ягодицы</option>'+
                '<option value="38" intro="all">Гениталии</option>'+
                '</optgroup>'+
                '<optgroup label="Конечности">'+
                '<option value="28" intro="all">Руки</option>'+
                '<option value="25" intro="all">ноги</option>'+
                '</optgroup>'+
                '<option value="33" intro="all">Общие симптомы</option>';



        $(document).ready(function(){
            // РАБОТАЕТ
            $('select').chosen({
                disable_search: true,
                no_results_text: "не найдено"
            });

            $('#body-render').on('click','area', function(){
                if ($(this).attr('intro') == 'head' ){
                    party = 'head';
                    renderBody();
                }else{
                    subParty = $(this).attr('data-key');
                    renderSymptom();
                }
                return false;
            });

            $('#select-state').on('click','li', function(){
                state = $(this).attr('data-key');
                url  = Routing.generate('render_symptom_article', { 'stateId' : state });
                $.ajax({
                    url: url,
                    cache: false,
                    success: function(html){
                        $('#articles-box').html(html);
//                        $('#select-symptom li').bind('click', 'selectSymptomChange');
                    }
                });

                return false;
            });

            $('#state-back').click(function(){
//                $('#list-box div').animate({ marginLeft: '0px' },300, function(){$('#select-disease').fadeIn();$('#select-state').fadeOut();});
                $('#select-disease').fadeIn();
                $('#select-state').fadeOut();
                return false;
            });

            // При смене пола меняет картику
            $('#select-sex').change(function(){
                sex = $('#select-sex').val();
                if (sex == 1){
                    $('#select-party').html(party_men)
                }else{
                    $('#select-party').html(party_women)
                }
                $('#select-party').chosen({
                    disable_search: true,
                    no_results_text: "не найдено"
                });
                renderBody();
            });



            $('#select-party').on('change',function(){
                p = $('#select-party').val();
                if ( p == 1  || p == 15 || p == 2  || p == 3  || p == 4  || p == 5  || p == 20  || p == 34  || p == 21  || p == 22  || p == 23  || p == 24 ){
                    party = 'head';
                }else{
                    if ( p == 7  || p == 8 || p == 10  || p == 11  || p == 31  || p == 13  || p == 9  || p == 6  || p == 14  || p == 25  || p == 28  || p == 33  || p == 26  || p == 27  || p == 29  || p == 30  || p == 38   ){
                        party = 'all';
                    }else{
                        if ( p == 16  || p == 17 || p == 18  || p == 35  || p == 36  || p == 37   ){
                            party = 'all-back';
                        }
                    }
                }
                renderBody();
                selectPatryChange($(this));
            });

            $('#select-symptom').on('click','li',function(){
                selectSymptomChange($(this));
                $('#select-disease').fadeIn();
                $('#select-state').fadeOut();
            });

            $('#select-disease').on('click','li',function(){
                selectDiseaseChange($(this));
            });


            function selectPatryChange(obj){
                subParty = obj.val();
                renderSymptom();
            }
            function selectSymptomChange(obj){
                symptom = obj.attr('data-key');
                renderDisease();
            }
            function selectDiseaseChange(obj){
                disease = obj.attr('data-key');
                renderState();
//                $('#list-box div').animate({marginLeft: -322},300, function(){$('#select-disease').fadeOut(); $('#select-state').fadeIn();});
                $('#select-disease').fadeOut();
                $('#select-state').fadeIn();
            }

            function renderSymptom(){
                url  = Routing.generate('render_symptom', { 'party' : subParty });
                $.ajax({
                    url: url,
                    cache: false,
                    success: function(html){
                        $('#select-symptom').html(html);
//                        $('#select-symptom li').bind('click', 'selectSymptomChange');
                    }
                });
            };
            function renderBody(){
                url  = Routing.generate('symptom_body', { 'sex' : sex , 'party' : party });
                $.ajax({
                    url: url,
                    cache: false,
                    success: function(html){
                        $("#body-render").html(html);
                    }
                });
            };
            function renderDisease(){
                url  = Routing.generate('render_disease', { 'symptom' : symptom });
                $.ajax({
                    url: url,
                    cache: false,
                    success: function(html){
                        $('#select-disease').html(html);
                    }
                });
            };
            function renderState(){
                url  = Routing.generate('render_state', { 'disease' : disease });
                $.ajax({
                    url: url,
                    cache: false,
                    success: function(html){
                        $('#select-state').html(html);
                    }
                });
            };

            renderSymptom();
        });


    </script>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        #list-box{
            width: 332px;
            overflow: hidden;
            text-align: left;
        }
        #list-box div{
            width: 664px;
        }
        .symptom-select{
            width: 200px;
            text-align: left;
        }
        .list-disease{
            border: 2px solid #EEE;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            padding-left: 0;
            width: 318px;
            display: inline-block;
        }
        .list-disease li{
            list-style: none;
            padding: 5px;
            margin-left: 0;
            text-align: left;
            color: #D71344;
        }
        .list-disease li:hover{
            background: #D71344;
            color: #FFF;
            cursor: pointer;
        }

    </style>
{% endblock %}