{% extends 'VidalDrugBundle::vidal_layout.html.twig' %}


{% block vidal %}
	{% if menu_drugs is defined %}
		{% include 'VidalDrugBundle:Drugs:menu_drugs.html.twig' %}
	{% endif %}

	<div class="description">
		<span>Клинико-фармакологический указатель</span>

		<div>
			Позволяет искать группы препаратов.
			Cоставлен на основании материалов, представленных в российских и зарубежных монографиях по
			фармакологии с использованием публикаций в периодических медицинских изданиях последних лет.
			<br/>
			<i>Например</i>:
			<a href="#17983" data="17983">Гомеопатические средства</a>,
			<a href="#17200" data="17217">Вакцины</a>.
		</div>
	</div>

	{% include 'VidalDrugBundle:Drugs:kfu_generated.html.twig' %}
{% endblock %}


{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" type="text/css" href="{{ asset('bundles/vidalmain/treeview/jquery.treeview.css') }}"/>
{% endblock %}


{% block javascripts %}
	{{ parent() }}
	<script src="{{ asset('bundles/vidalmain/treeview/jquery.treeview.js') }}" type="text/javascript"></script>
	<script src="{{ asset('bundles/vidalmain/treeview/jquery.treeview.edit.js') }}" type="text/javascript"></script>
	<script src="{{ asset('bundles/vidalmain/treeview/jquery.treeview.async.kfu.js') }}" type="text/javascript"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			var $tree = $('.treeview');

			$tree.treeview({
				animated:  "fast",
				collapsed: true,
				url:       Routing.generate('kfu_ajax'),
				ajax:      {
					type: "post"
				}
			});

			$('#tree_collapse').on('click', function() {
				$tree.find('ul').hide();
				$tree.find('div.collapsable-hitarea').removeClass('collapsable-hitarea').addClass('expandable-hitarea');
				$tree.find('div.lastCollapsable-hitarea').removeClass('lastCollapsable-hitarea').addClass('lastExpandable-hitarea');
				$tree.find('li.collapsable').removeClass('collapsable').addClass('expandable');
				$tree.find('li.lastCollapsable').removeClass('lastCollapsable').addClass('lastExpandable');
				return false;
			});

			$('a[data="17983"]').click(function() {
				$('#tree_collapse').click();
				$tree.find('span').removeClass('highlight');
				$('#17983 > div').click();
				$('#17983 > span').addClass('highlight');
			});

			$('a[data="17217"]').click(function() {
				$('#tree_collapse').click();
				$tree.find('span').removeClass('highlight');
				$('#17200 > div').click();
				$('#17200 > span').addClass('highlight');
				setTimeout(function() {
					$('#17217 > div').click();
					$('#17217 > span').addClass('highlight');
				}, 1000);
			});

			{# если мы пришли показать КФУ - надо подгрузить и раскрыть конкретный узел #}
			{% if showBaseKfu is defined %}
			function parentCb() {
				var $show = $('#{{ showKfu.ClPhPointerID }}');
				if ($show.length == 0) {
					setTimeout(parentCb, 500);
				}
				else {
					$show.parents('li').removeClass('expandable').addClass('collapsable')
						.find('> div').removeClass('expandable-hitarea').addClass('collapsable-hitarea')
						.siblings('ul').show();
					$show.find('> i, > span').addClass('highlight');
					$('html, body').animate({ scrollTop: $show.closest('ul').offset().top}, 1000);
				}
			}

			var $base = $('#{{ showBaseKfu.ClPhPointerID }}');
			$base.find(' > div').click();
			setTimeout(parentCb, 500);
			{% endif %}
		});
	</script>
{% endblock %}